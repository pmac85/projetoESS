<% provide(:title, "Journeys") %>
<% jogos="" %>

<script>var jogos=new Array()
function searchTeamName(id, teams){

 for(c=0;c<teams.length;c++){
   if(id==teams[c].id){
    return teams[c].name;
   }
 }
  return "ERROR";
}

function changedslct(sel){

  var dv=document.getElementById("gPresent");
  var jdt=sel.value;
  var jn=sel.selectedIndex;
  var jogos2=JSON.parse(jogos[jn]);

  var next="<h3></h3><table class=\"j-table-all\"><thead><tr><th colspan='3' class='thJ'> Journey "+(jn+1)+"<br>"+jdt+"</th></tr></thead><tbody>";
  for(x=0;x<jogos2.length;x++){
    var scr = "---";
    console.log(jogos2[x]);
    if (jogos2[x].team1_score != null && jogos2[x].team2_score != null) {
      scr = jogos2[x].team1_score+" - "+jogos2[x].team2_score;
    }
    var t1 = searchTeamName(jogos2[x].team1_id, teams);
    var t2 = searchTeamName(jogos2[x].team2_id, teams);
      next+="<tr><td>"+t1+"</td><td data-toggle='modal' data-target='#"+jogos2[x].id+"' class='clickable'>"+scr+"</td><td>"+t2+"</td></tr>";
  }

  next+="</tbody></table>";
  dv.innerHTML=next;
}
</script>

<div class="divs">
  <% @journeys.each do |journey| %>
      <% journey.games.each do |game|%>
        <%= render "games/modal", game: game %>
      <% end %>
  <% end %>
  <div class="col-md-4 col-md-offset-4">
  <select class="btn btn-default" id="jselect" onchange="changedslct(this)" style="font-size: 14px;">
    <% @journeys.each do |journey| %>
        <%= javascript_tag "jogos.push('#{journey.games.to_json}');" %>
      <% puts()%>
        <% if(journey.date == Date.today()) %>
            <option value="<%= journey.date %>" selected>Journey <%= journey.number %></option>
        <% else %>
            <option value="<%= journey.date %>" >Journey <%= journey.number %></option>
        <% end %>
    <% end %>
  </select>
  </div>
  <div class="col-md-8 col-md-offset-2" id="gPresent"></div>
  <%= javascript_tag "var teams='#{@teams.to_json}';" %>
  <script>
    teams=JSON.parse(teams);
    $("#jselect").trigger("change");
  </script>

</div>

